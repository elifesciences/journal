{% set criticalCss = 'article' %}

{% extends '::page.html.twig' %}

{% block canonical %}
    {{ path('article', {id: item.id}) }}
{% endblock %}

{% block meta %}

    {{ parent() }}

    {% if google_scholar_metadata ?? false %}

        <meta name="citation_journal_title" content="eLife">
        <meta name="citation_publisher" content="eLife Sciences Publications Limited">
        <meta name="citation_journal_abbrev" content="eLife Sciences">
        <meta name="citation_issn" content="2050-084X">
        <meta name="citation_fulltext_world_readable" content="">
        <meta name="citation_language" content="en">

        <meta name="citation_title" content="{{ item.fullTitle|striptags }}">
        <meta name="citation_id"
              content="eLife {{ item.publishedDate|date('Y', 'UTC') }};{{ item.volume }}:{{ item.eLocationId }}">
        <meta name="citation_firstpage" content="{{ item.eLocationId }}">
        <meta name="citation_public_url" content="{{ url('article', {id: item.id}) }}">
        {% if item.pdf %}
            <meta name="citation_pdf_url" content="{{ absolute_url(pdfPath) }}">
        {% endif %}
        {% if item.xml %}
            <meta name="citation_xml_url" content="{{ absolute_url(xmlPath) }}">
        {% endif %}
        <meta name="citation_doi" content="{{ item.doi }}">
        <meta name="citation_volume" content="{{ item.volume }}">
        {% if item.issue %}
            <meta name="citation_issue" content="{{ item.issue }}">
        {% endif %}
        {% if item.publishedDate %}
            <meta name="citation_publication_date" content="{{ item.publishedDate|date('Y/m/d', 'UTC') }}">
        {% endif %}

        {% if item.funding is defined and item.funding %}
            {% for award in item.funding.awards %}
                <meta name="citation_funding_source" content="citation_funder={{ award.source.place.toString }};
                    {%- if award.source.funderId -%}
                        citation_funder_id={{ award.source.funderId }};
                    {%- endif -%}
                    {%- if award.awardId -%}
                        citation_grant_number={{ award.awardId }};
                    {%- endif -%}
                    {%- for recipient in award.recipients -%}
                        citation_grant_recipient={{ recipient.toString }}{% if not loop.last %};{% endif -%}
                    {%- endfor -%}
                ">
            {% endfor %}
        {% endif %}

        {% if item.keywords is defined and item.keywords|length %}
            <meta name="citation_keywords" content="
                {%- for keyword in item.keywords -%}
                    {{- keyword|striptags -}}
                    {%- if not loop.last %}; {% endif -%}
                {%- endfor -%}
            ">
        {% endif %}

        {% if item.subjects|length %}
            <meta name="citation_section" content="
                {%- for subject in item.subjects -%}
                    {{- subject.name|striptags -}}
                    {%- if not loop.last %}; {% endif -%}
                {%- endfor -%}
            ">
        {% endif %}

        {% for author in item.authors %}
            {% if author.affiliations is defined %}
                <meta name="citation_author" content="{{ author.toString }}">
                {% for institution in author.affiliations %}
                    <meta name="citation_author_institution" content="{{ institution.toString }}">
                {% endfor %}
                {% for emailAddress in author.emailAddresses %}
                    <meta name="citation_author_email" content="{{ emailAddress }}">
                {% endfor %}
                {% if author.preferredName is defined %}
                    {% if author.orcid %}
                        <meta name="citation_author_orcid" content="https://orcid.org/{{ author.orcid }}">
                    {% endif %}
                {% endif %}
            {% endif %}
        {% endfor %}

        {% if item.references is defined -%}

            {%- for reference in item.references %}

                {%- set type = reference_type(reference) -%}

                {%- if type == 'book' -%}

                    <meta name="citation_reference"
                          content="
                            citation_title={{ reference.bookTitle }};
                            {% for author in reference.authors %}
                                citation_author={{ author.toString }};
                            {% endfor %}
                            citation_publisher={{ reference.publisher.name|join(', ') }};
                            citation_publication_date={{ reference.date.toString }};
                            {% if reference.isbn %}
                                citation_isbn={{ reference.isbn }};
                            {% endif %}
                        ">

                {%- elseif type == 'book-chapter' -%}

                    <meta name="citation_reference"
                          content="
                            citation_title={{ reference.chapterTitle }};
                            {% for author in reference.authors %}
                                citation_author={{ author.toString }};
                            {% endfor %}
                            citation_inbook_title={{ reference.bookTitle }};
                            citation_publisher={{ reference.publisher.name|join(', ') }};
                            citation_publication_date={{ reference.date.toString }};
                            {% if reference.isbn %}
                                citation_isbn={{ reference.isbn }};
                            {% endif %}
                            {% if reference.pages.first is defined %}
                                citation_firstpage={{ reference.pages.first }};
                                citation_lastpage={{ reference.pages.last }};
                                citation_pages={{ reference.pages.range }};
                            {% else %}
                                citation_firstpage={{ reference.pages.toString }};
                            {% endif %}
                        ">

                {%- elseif type == 'clinical-trial' -%}

                    <meta name="citation_reference"
                          content="
                            citation_title={{ reference.title }};
                            {% for author in reference.authors %}
                                citation_author={{ author.toString }};
                            {% endfor %}
                            citation_publication_date={{ reference.date.toString }};
                        ">

                {%- elseif type == 'conference-proceeding' -%}

                    <meta name="citation_reference"
                          content="
                            citation_title={{ reference.articleTitle }};
                            {% for author in reference.authors %}
                                citation_author={{ author.toString }};
                            {% endfor %}
                            citation_conference_title={{ reference.conference.name|join(', ') }};
                            citation_publication_date={{ reference.date.toString }};
                            {% if reference.pages.first is defined %}
                                citation_firstpage={{ reference.pages.first }};
                                citation_lastpage={{ reference.pages.last }};
                                citation_pages={{ reference.pages.range }};
                            {% elseif reference.pages %}
                                citation_firstpage={{ reference.pages.toString }};
                            {% endif %}
                        ">

                {%- elseif type == 'data' -%}

                    <meta name="citation_reference"
                          content="
                            citation_title={{ reference.title }};
                            {% for author in reference.authors %}
                                citation_author={{ author.toString }};
                            {% endfor %}
                            {% for compiler in reference.compilers %}
                                citation_author={{ compiler.toString }};
                            {% endfor %}
                            {% for curator in reference.curators %}
                                citation_author={{ curator.toString }};
                            {% endfor %}
                            citation_publisher={{ reference.source }};
                            citation_publication_date={{ reference.date.toString }};
                        ">

                {%- elseif type == 'journal' -%}

                    <meta name="citation_reference"
                          content="
                            citation_journal_title={{ reference.journal }};
                            citation_title={{ reference.articleTitle }};
                            citation_publication_date={{ reference.date.toString }};
                            {% if reference.doi %}
                                citation_doi={{ reference.doi }};
                            {% endif %}
                            {% if reference.pmid %}
                                citation_pmid={{ reference.pmid }};
                            {% endif %}
                            {% for author in reference.authors %}
                                citation_author={{ author.toString }};
                            {% endfor %}
                            {% if reference.volume %}
                                citation_volume={{ reference.volume }};
                            {% endif %}
                            {% if reference.pages.first is defined %}
                                citation_firstpage={{ reference.pages.first }};
                                citation_lastpage={{ reference.pages.last }};
                                citation_pages={{ reference.pages.range }};
                            {% else %}
                                citation_firstpage={{ reference.pages.toString }};
                            {% endif %}
                        ">

                {%- elseif type == 'patent' -%}

                    <meta name="citation_reference"
                          content="
                            citation_title={{ reference.title }};
                            citation_publication_date={{ reference.date.toString }};
                            {% for inventor in reference.inventors %}
                                citation_author={{ inventor.toString }};
                            {% endfor %}
                            citation_patent_country={{ reference.country }};
                            {% if reference.number %}
                                citation_patent_number={{ reference.number }};
                            {% endif %}
                        ">

                {%- elseif type == 'periodical' -%}

                    <meta name="citation_reference"
                          content="
                            citation_title={{ reference.articleTitle }};
                            {% for author in reference.authors %}
                                citation_author={{ author.toString }};
                            {% endfor %}
                            citation_publisher={{ reference.periodical }};
                            citation_publication_date={{ reference.date.toString }};
                        ">

                {%- elseif type == 'preprint' -%}

                    <meta name="citation_reference"
                          content="
                            citation_title={{ reference.articleTitle }};
                            {% for author in reference.authors %}
                                citation_author={{ author.toString }};
                            {% endfor %}
                            citation_publication_date={{ reference.date.toString }};
                            citation_technical_report_institution={{ reference.source }};
                        ">

                {%- elseif type == 'report' -%}

                    <meta name="citation_reference"
                          content="
                            citation_title={{ reference.title }};
                            {% for author in reference.authors %}
                                citation_author={{ author.toString }};
                            {% endfor %}
                            citation_publication_date={{ reference.date.toString }};
                            citation_technical_report_institution={{ reference.publisher.name|join(', ') }};
                        ">

                {%- elseif type == 'software' -%}

                    <meta name="citation_reference"
                          content="
                            citation_title={{ reference.title }};
                            {% for author in reference.authors %}
                                citation_author={{ author.toString }};
                            {% endfor %}
                            citation_publisher={{ reference.publisher.name|join(', ') }};
                            citation_publication_date={{ reference.date.toString }};
                        ">

                {%- elseif type == 'thesis' -%}

                    <meta name="citation_reference"
                          content="
                            citation_title={{ reference.title }};
                            citation_author={{ reference.author.preferredName }};
                            citation_dissertation_institution={{ reference.publisher.name|join(', ') }};
                            citation_publication_date={{ reference.date.toString }};
                        ">

                {%- elseif type == 'unknown' -%}

                    <meta name="citation_reference"
                          content="
                            citation_title={{ reference.title }};
                            {% for author in reference.authors %}
                                citation_author={{ author.toString }};
                            {% endfor %}
                            citation_publication_date={{ reference.date.toString }};
                        ">

                {%- elseif type == 'web' -%}

                    <meta name="citation_reference"
                          content="
                            citation_title={{ reference.title }};
                            citation_publication_date={{ reference.date.toString }};
                            {% for author in reference.authors %}
                                citation_author={{ author.toString }};
                            {% endfor %}
                            {% if reference.website %}
                                citation_publisher={{ reference.website }};
                            {% endif %}
                        ">

                {%- endif %}

            {% endfor -%}

        {%- endif %}

    {%- endif %}

    {% if is_granted('FEATURE_PRC_COMMS') %}
        <style>
            .article-prc-message {
                font-family: "Noto Sans",Arial,Helvetica,sans-serif;
                font-size: calc((14 / 16) * 1rem);
                line-height: 1.7;

                background-color: #f5f7fa;
                padding-top: calc((12 / 14) * 1em);
                padding-bottom: calc((12 / 14) * 1em);
                padding-left: calc(1rem /* space before icon*/ + calc((20 / 14) * 1em) /* width of icon */ + ((12 / 14) * 1em) /* space after icon */);

                position: relative;

                grid-column: 1 / -1;
            }

            .article-prc-message::before {
                content: '';
                display: block;
                width: calc((20 / 14) * 1em);
                height: calc((20 / 14) * 1em);
                background-image: url('data:image/svg+xml;utf8,<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>Information</title><path d="M10 0C4.5 0 0 4.5 0 10s4.5 10 10 10 10-4.5 10-10S15.5 0 10 0zm1 15H9V9h2v6zm0-8H9V5h2v2z" fill="%23177cc9" fill-rule="evenodd"/></svg>');
                background-repeat: no-repeat;
                background-size: contain;

                position: absolute;
                left: 1rem;
                top: 1em;
            }

            .wrapper.wrapper-article-prc-message {
                padding-left: 0;
                padding-right: 0;
            }

            @media screen and (min-width: 30em /* 480px */) {
                .wrapper.wrapper-article-prc-message {
                    padding-left: 3rem;
                    padding-right: 3rem;
                }
            }

            @media screen and (min-width: 56.25em /* 900px */) {
                .article-prc-message {
                    grid-column: 2 / 12;
                }
            }

            @media screen and (min-width: 75em /* 1200px */) {
                .article-prc-message {
                    grid-column: 1 / -1;
                }
            }

        </style>
    {% endif %}

{% endblock %}

{% block body %}

    {% if is_granted('FEATURE_PRC_COMMS') %}
        <div class="wrapper wrapper-article-prc-message">
            <div class="content-container-grid">
                <p class="article-prc-message">In 2023, eLife will stop rejecting or accepting research after peer review. Instead, every preprint sent for review will be published. About the process.</p>
            </div>
        </div>
    {% endif %}
    {{ render_pattern(contentHeader) }}

    {% for modalWindow in modalWindows %}
        {{ render_pattern(modalWindow) }}
    {% endfor %}

    {% include 'calls-to-action.html.twig' %}

    <div data-behaviour="DelegateBehaviour" data-delegate-behaviour="Popup" data-selector=".article-section:not(#abstract) a">

        {% block article_body %}{% endblock %}

    </div>

    {{ schema_org_metadata(item) }}

{% endblock %}
