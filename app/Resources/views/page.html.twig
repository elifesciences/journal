<!doctype html>

<html lang="en" prefix="og: http://ogp.me/ns#">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">

    <title>{% block title %}{{ title }}{% endblock %} | eLife</title>

    {# We don't use gulp-favicon's generated file as it includes things we don't want, such as apple-mobile-web-app-capable #}
    <link rel="apple-touch-icon" sizes="57x57" href="{{ asset('favicons/apple-touch-icon-57x57.png') }}">
    <link rel="apple-touch-icon" sizes="60x60" href="{{ asset('favicons/apple-touch-icon-60x60.png') }}">
    <link rel="apple-touch-icon" sizes="72x72" href="{{ asset('favicons/apple-touch-icon-72x72.png') }}">
    <link rel="apple-touch-icon" sizes="76x76" href="{{ asset('favicons/apple-touch-icon-76x76.png') }}">
    <link rel="apple-touch-icon" sizes="114x114" href="{{ asset('favicons/apple-touch-icon-114x114.png') }}">
    <link rel="apple-touch-icon" sizes="120x120" href="{{ asset('favicons/apple-touch-icon-120x120.png') }}">
    <link rel="apple-touch-icon" sizes="144x144" href="{{ asset('favicons/apple-touch-icon-144x144.png') }}">
    <link rel="apple-touch-icon" sizes="152x152" href="{{ asset('favicons/apple-touch-icon-152x152.png') }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ asset('favicons/apple-touch-icon-180x180.png') }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ asset('favicons/favicon-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="192x192" href="{{ asset('favicons/android-chrome-192x192.png') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ asset('favicons/favicon-16x16.png') }}">
    <link rel="shortcut icon" href="{{ asset('favicons/favicon.ico') }}">
    <link rel="manifest" href="{{ asset('favicons/manifest.json') }}">
    <meta name="theme-color" content="#ffffff">
    <meta name="application-name" content="eLife">

    {% block stylesheets deferred %}
    {% for stylesheet in stylesheets %}
        <link href="{{ resource_url(stylesheet) }}" rel="stylesheet">
    {% endfor %}
    {% endblock %}

    <meta name="format-detection" content="telephone=no">

    {% block meta %}

        {% if block('canonical') %}
            {% set canonical = block('canonical')|trim %}
        {% elseif paginator is defined %}
            {% set canonical = paginator.currentPagePath %}
        {% else %}
            {% set canonical = path(app.request.attributes.get('_route'), app.request.attributes.get('_route_params')) %}
        {% endif %}

        <meta property="og:site_name" content="eLife">
        <meta property="og:url" content="{{ app.request.uriForPath(canonical) }}">
        <meta property="og:title" content="{{ title }}">
        <meta name="twitter:site" content="@eLife">

        {% if contentHeader is defined and contentHeader.strapline is defined %}
            <meta property="og:description" content="{{ contentHeader.strapline|striptags }}">
        {% elseif leadParas is defined and leadParas %}
            <meta property="og:description" content="{{ render_pattern(leadParas)|striptags|single_line|trim }}">
        {% endif %}
        {% if contentHeader is defined and contentHeader.backgroundImage is defined %}
            <meta name="twitter:card" content="summary_large_image">
            {% if '/' == contentHeader.backgroundImage.highResImageSource|first %}
                <meta property="og:image"
                      content="{{ app.request.uriForPath(contentHeader.backgroundImage.highResImageSource) }}">
            {% else %}
                <meta property="og:image" content="{{ contentHeader.backgroundImage.highResImageSource }}">
            {% endif %}
            <meta property="og:image:width" content="1800">
            <meta property="og:image:height" content="900">
        {% else %}
            <meta name="twitter:card" content="summary">
        {% endif %}
        {% if contentHeader is defined and contentHeader.meta is defined %}
            <meta property="og:type" content="article">
            {% if contentHeader.subjects is defined %}
                {% for subject in contentHeader.subjects.list %}
                    <meta property="og:article:section" content="{{ subject.name }}">
                {% endfor %}
            {% endif %}
        {% endif %}

        <link rel="canonical" href="{{ canonical }}">

        {% if paginator is defined %}

            {% if paginator.previousPage %}
                <link rel="prev" href="{{ paginator.previousPagePath }}">
            {% endif %}

            {% if paginator.nextPage %}
                <link rel="next" href="{{ paginator.nextPagePath }}">
            {% endif %}

        {% endif %}

    {% endblock %}

    <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"
            integrity="sha256-3Jy/GbSLrg0o9y5Z5n1uw0qxZECH7C6OQpVBgNFYa0g=" crossorigin="anonymous"></script>
    <script>document.createElement('picture');</script>
    <![endif]-->

    <script>
        WebFontConfig = {
            custom: {
                families: ["Avenir Next Webfont"],
                urls: ["{{ resource_url('/elife/patterns/assets/fonts/fonts.css') }}"]
            }
        };

        (function (d) {
            var wf = d.createElement("script");
            var s = d.scripts[0];
            wf.src = "https://ajax.googleapis.com/ajax/libs/webfont/1.6.16/webfont.js";
            s.parentNode.insertBefore(wf, s);
        })(document);
    </script>

</head>

<body class="body">

<div class="global-wrapper">

    <div class="global-inner">

        {% if header %}
            {{ render_pattern(header) }}
        {% endif %}

        {% if app.request.hasPreviousSession %}
            {% for type, messages in app.session.flashbag.all %}
                {% for message in messages %}
                    {{ info_bar(message, type) }}
                {% endfor %}
            {% endfor %}
        {% endif %}

        {% block info_bar %}{% endblock %}

        <main role="main" class="blg-margin-bottom-large">

            {% block body %}{% endblock %}

        </main>

        {% if footer %}
            {{ render_pattern(footer) }}
        {% endif %}

    </div>

</div>

{% block javascripts deferred %}
{% for javascript in javascripts %}
    <script src="{{ resource_url(javascript) }}"></script>
{% endfor %}
{% endblock %}

</body>

</html>
