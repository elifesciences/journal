version: '3'

services:
    composer:
        platform: linux/amd64
        build:
            args:
                composer_dev_arg:
        volumes:
            - ./composer.json:/app/composer.json
            - ./composer.lock:/app/composer.lock
            - ./vendor:/app/vendor
    npm:
        platform: linux/amd64
        volumes:
            - ./npm-shrinkwrap.json:/npm-shrinkwrap.json
            - ./package.json:/package.json
            - node_modules:/node_modules
    assets_builder:
        platform: linux/amd64
        volumes:
            - ./assets/images:/assets/images
            - assets:/web
            - build:/build
            - node_modules:/node_modules
            - ./gulpfile.js:/gulpfile.js
    app:
        platform: linux/amd64
        environment:
            - APP_ENV=${APP_ENV}
        volumes:
            - ./:/srv/journal
            - ./.docker/php.ini:/usr/local/etc/php/conf.d/x-dev.ini
            - /srv/journal/var
            - build:/srv/journal/build
            - critical_css:/srv/journal/build/critical-css
            - ./vendor:/srv/journal/vendor
    web:
        platform: linux/amd64
        volumes:
            - assets:/srv/journal/web
    critical_css:
        platform: linux/amd64
        volumes:
            - critical_css:/build/critical-css
            - node_modules:/node_modules

volumes:
    assets:
    build:
    critical_css:
    node_modules:
